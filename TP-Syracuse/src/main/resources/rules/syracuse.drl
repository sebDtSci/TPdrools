package rules

unit SyracuseUnit

import drools.SyracuseData
import java.util.List


rule 'hello world' 
    when 
        
    
    then 
        Util.debug("Hello World");


rule 'InitializeSyracuseSequence' 
    when 
        $startValue : /startValue;
        $data : /syracuseData[ sequence.size() == 0 ];
    
    then 
        List<Integer> sequence = $data.getSequence();
        int currentValue = $startValue;
        sequence.add(currentValue);
        modify($data);
        modify($$startValue);
    


rule 'CalculateNextSyracuseNumber' 
    when 
        $data : /syracuseData[ sequence.size() > 0 ];
        $currentValue : Integer() from $data.getSequence().get($data.getSequence().size() - 1);
        eval($currentValue != 1);
    
    then 
        int nextNumber = ($currentValue % 2 == 0) ? $currentValue / 2 : $currentValue * 3 + 1;
        $data.getSequence().add(nextNumber);
        modify($data);
    


rule 'CalculateMetrics' 
    when 
        $data : /syracuseData[ sequence.size() > 0 && $data.getSequence().get($data.getSequence().size() - 1) == 1 ];
        $startValue : /startValue;
    then 
        List<Integer> sequence = $data.getSequence();
        int startValue = $startValue;
        int flightTime = sequence.size() - 1;
        int flightTimeOnAltitude = 0;
        int maxAltitude = 0;

        for (int value : sequence) {
            if (value > startValue) {
                flightTimeOnAltitude++;
            }
            if (value > maxAltitude) {
                maxAltitude = value;
            }
        }

        $data.setFlightTime(flightTime);
        $data.setFlightTimeOnAltitude(flightTimeOnAltitude);
        $data.setMaxAltitude(maxAltitude);
        modify($data);
    